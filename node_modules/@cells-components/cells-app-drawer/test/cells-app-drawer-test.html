<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/wct-mocha/wct-mocha.js"></script>
  <script src="../node_modules/chai/chai.js"></script>
  <script src="../node_modules/sinon/pkg/sinon.js"></script>
  <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
  <script src="../node_modules/sinon-chai/lib/sinon-chai.js"></script>
</head>

<body>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    .menu {
      background-color: rgba(0, 255, 0, .15);
      width: 100%;
      height: 100%;
    }
    .content {
      background-color: rgba(255, 0, 0, .15);
      width: 100%;
      height: 100%;
    }
  </style>

  <test-fixture id="el">
    <template>
      <cells-app-drawer class="notransition">
        <div slot="drawer">
          <div class="menu">
            <span class="menu-point"></span>
            <span class="menu-right-point" style="position: absolute; right: 0;"></span>
            <button class="btn-menu">Close menu</button>
            <p>Contenido del menu</p>
          </div>
        </div>
        <div slot="main">
          <div class="content">
            <span class="ctn-point"></span>
            <span class="ctn-right-point" style="position: absolute; right: 0;"></span>
            <button class="btn-cnt">Open menu</button>
            <p>Contenido de la p√°gina</p>
          </div>
        </div>
        <button paper-drawer-toggle>Toggle</button>
        <button class="not-toggle">Not toggle</button>
      </cells-app-drawer>
    </template>
  </test-fixture>

  <script type="module">
    import { tap, track, down, up } from './test.js';

    suite('methods', () => {
      let el;

      setup(async () => {
        el = fixture('el');
        el.resetSharedPanel();
        await el.updateComplete;
      });

      suite('open and close', () => {
        test('openDrawer method adds class to drawer', (done) => {
          const drawer = el.shadowRoot.querySelector('#drawer');
          assert.isFalse(drawer.classList.contains('transition-drawer'));
          el.openDrawer();
          requestAnimationFrame(() => {
            assert.isTrue(drawer.classList.contains('transition-drawer'));
            done();
          });
        });

        test('closeDrawer method adds class to drawer', (done) => {
          const drawer = el.shadowRoot.querySelector('#drawer');
          assert.isFalse(drawer.classList.contains('transition-drawer'));
          el.closeDrawer();
          requestAnimationFrame(() => {
            assert.isTrue(drawer.classList.contains('transition-drawer'));
            done();
          });
        });

        test('openDrawer method selects drawer', (done) => {
          assert.notEqual(el.selected, 'drawer');
          el.openDrawer();
          requestAnimationFrame(() => {
            assert.equal(el.selected, 'drawer');
            done();
          });
        });

        test('closeDrawer method selects main', (done) => {
          el.selected = 'drawer';
          el.updateComplete.then(() => {
            assert.notEqual(el.selected, 'main');
            el.closeDrawer();
            requestAnimationFrame(() => {
              assert.equal(el.selected, 'main');
              done();
            });
          });
        });

        test('togglePanel on an opened drawer closes drawer', (done) => {
          el.selected = 'drawer';
          el.updateComplete.then(() => {
            assert.notEqual(el.selected, 'main');
            el.togglePanel();
            requestAnimationFrame(() => {
              assert.equal(el.selected, 'main');
              done();
            });
          });
        });

        test('togglePanel on a closed drawer opens drawer', (done) => {
          el.selected = 'main';
          el.updateComplete.then(() => {
            assert.notEqual(el.selected, 'drawer');
            el.togglePanel();
            requestAnimationFrame(() => {
              assert.equal(el.selected, 'drawer');
              done();
            });
          });
        });
      });

      suite('tap', () => {
        test('tap on button with paper toggle attribute toggles the panel', (done) => {
          assert.notEqual(el.selected, 'drawer');
          const button = el.querySelector('[paper-drawer-toggle]');
          tap(button);
          requestAnimationFrame(() => {
            assert.equal(el.selected, 'drawer');
            done();
          });
        });
        test('tap on button without paper toggle attribute does not toggle the panel', (done) => {
          assert.notEqual(el.selected, 'drawer');
          const button = el.querySelector('.not-toggle');
          tap(button);
          requestAnimationFrame(() => {
            assert.notEqual(el.selected, 'drawer');
            done();
          });
        });
      });

      suite('track', () => {
        test('track panel from edge from left to right will open panel', (done) => {
          assert.notEqual(el.selected, 'drawer');
          track(el.querySelector('.ctn-point'), 100, 0);
          requestAnimationFrame(() => {
            assert.equal(el.selected, 'drawer');
            done();
          });
        });

        test('track panel from edge from right to left will close panel', (done) => {
          el.selected = 'drawer';
          el.updateComplete.then(() => {
            track(el.querySelector('.ctn-point'), -100, 0);
            requestAnimationFrame(() => {
              assert.equal(el.selected, 'main');
              done();
            });
          });
        });

        test('track right drawer panel from edge from right to left will open panel', (done) => {
          el.rightDrawer = true;
          el.updateComplete.then(() => {
            assert.notEqual(el.selected, 'drawer');
            track(el.querySelector('.ctn-right-point'), -100, 0);
            requestAnimationFrame(() => {
              assert.equal(el.selected, 'drawer');
              done();
            });
          });
        });

        test('track right drawer panel from edge from left to right will close panel', (done) => {
          el.selected = 'drawer';
          el.rightDrawer = true;
          el.updateComplete.then(() => {
            track(el.querySelector('.ctn-right-point'), 100, 0);
            requestAnimationFrame(() => {
              assert.equal(el.selected, 'main');
              done();
            });
          });
        });

        test('track panel not from edge will not toggle panel', (done) => {
          assert.notEqual(el.selected, 'drawer');
          track(el, 100, 0);
          requestAnimationFrame(() => {
            assert.notEqual(el.selected, 'drawer');
            done();
          });
        });
      });

      suite('peek', () => {
        test('mousedown on edge with peek will set peeking to true', async () => {
          el.peek = true;
          await el.updateComplete;
          assert.isFalse(el.peeking);
          down(el.querySelector('.ctn-point'));
          assert.isTrue(el.peeking);
        });

        test('mousedown not on edge with peek will not set peeking to true', () => {
          el.peek = true;
          assert.isFalse(el.peeking);
          down(el);
          assert.isFalse(el.peeking);
        });

        test('mousedown on edge without peek will set peeking to true', () => {
          assert.isFalse(el.peeking);
          down(el.querySelector('.ctn-point'));
          assert.isFalse(el.peeking);
        });

        test('mouseup while peeking removes peeking state', async () => {
          el.peek = true;
          await el.updateComplete;
          down(el.querySelector('.ctn-point'));
          await el.updateComplete;
          assert.isTrue(el.peeking);
          up(el.querySelector('.ctn-point'));
          assert.isFalse(el.peeking);
        });

        test('track while peeking will remove peeking state', async () => {
          el.peek = true;
          await el.updateComplete;
          down(el.querySelector('.ctn-point'));
          assert.isTrue(el.peeking);
          track(el.querySelector('.ctn-point'), 100, 0);
          assert.isFalse(el.peeking);
        });
      });

    });
  </script>
</body>

</html>
