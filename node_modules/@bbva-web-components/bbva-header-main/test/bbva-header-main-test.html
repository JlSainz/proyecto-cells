<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <title>bbva-header-main test</title>
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/wct-mocha/wct-mocha.js"></script>
  <script src="../node_modules/chai/chai.js"></script>
  <script src="../node_modules/sinon/pkg/sinon.js"></script>
  <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
  <script src="../node_modules/sinon-chai/lib/sinon-chai.js"></script>
</head>

<body>
  <test-fixture id="default">
    <template>
      <bbva-header-main></bbva-header-main>
    </template>
  </test-fixture>

  <script type="module">
    import './test.js';

    const IMAGE_1PIXEL = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';

    suite('<bbva-header-main>', () => {
      let el;

      setup(async () => {
        el = fixture('default');
        await el.updateComplete;
      });

      test('it shows the correct text', async () => {
        const expectedText = 'hello World';
        el.text = expectedText;
        await el.updateComplete;
        const textShowed = el.shadowRoot.querySelector('#text').textContent;

        assert.equal(textShowed, expectedText);
      });

      [{
        selector: '#btn-left1',
        event: 'header-icon-left1-click'
      },
      {
        selector: '#btn-left2',
        event: 'header-icon-left2-click'
      },
      {
        selector: '#btn-right1',
        event: 'header-icon-right1-click'
      },
      {
        selector: '#btn-right2',
        event: 'header-icon-right2-click'
      }].forEach((button) => {
        test(`it sends ${button.event} event`, () => {
          const btn = el.shadowRoot.querySelector(button.selector);
          const spy = sinon.spy();

          el.addEventListener(button.event, spy);
          btn.click();
          assert.ok(spy.calledOnce);
        });
      });

      [{
        selector: '#btn-left1'
      },
      {
        selector: '#btn-left2'
      },
      {
        selector: '#btn-right1'
      },
      {
        selector: '#btn-right2'
      }].forEach((button) => {
        test(`it doesn't shows ${button.selector} when icons have no value`, () => {
          const btn = el.shadowRoot.querySelector(button.selector);
          assert.ok(btn.hidden);
        });
      });

      test('it headding has "full-padding" class when it has icon left or right', async () => {
        el.iconLeft2 = 'foo';
        await el.updateComplete;
        const headding = el.shadowRoot.querySelector('#headding');

        assert.ok(headding.classList.contains('full-padding'));
      });

      test('it headding has "image" class when it has an image', async () => {
        const pixelImage = IMAGE_1PIXEL;
        el.image = pixelImage;
        await el.updateComplete;
        const headding = el.shadowRoot.querySelector('#headding');

        assert.ok(headding.classList.contains('image'));
      });

      test('it shows the image correctly when it has an image', async () => {
        const pixelImage = IMAGE_1PIXEL;
        el.image = pixelImage;
        await el.updateComplete;
        const image = el.shadowRoot.querySelector('#image');

        assert.notOk(image.hidden, 'image not hidden');
        assert.ok(image.src.includes('data:image/gif;base64'), 'correct image source');
      });
    });
  </script>
</body>

</html>
